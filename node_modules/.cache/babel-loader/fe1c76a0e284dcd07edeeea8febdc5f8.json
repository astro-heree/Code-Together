{"ast":null,"code":"import _regeneratorRuntime from\"/Users/amankumar/Code-Together/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/amankumar/Code-Together/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/amankumar/Code-Together/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useRef,useState}from'react';import Client from'../components/Client';import Editor from'../components/Editor';import{initSocket}from'../socket';import ACTIONS from'../Actions';import{Navigate,useLocation,useNavigate,useParams}from'react-router-dom';import toast from'react-hot-toast';import CodeRun from'../components/CodeRun';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var EditorPage=function EditorPage(){var _location$state3;var codeRef=useRef(null);var socketRef=useRef(null);var location=useLocation();var _useParams=useParams(),roomId=_useParams.roomId;var reactNavigator=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _location$state;var handleErrors;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:handleErrors=function _handleErrors(e){toast.error('Socket connection failed, try again later.');reactNavigator('/');};_context.next=3;return initSocket();case 3:socketRef.current=_context.sent;socketRef.current.on('connect_error',function(err){return handleErrors(err);});socketRef.current.on('connect_failed',function(err){return handleErrors(err);});socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});// Listening for joined events\nsocketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state2;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});});//listening for disconnected\nsocketRef.current.on(ACTIONS.DISCONNECTED,function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});case 9:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){var _socketRef$current,_socketRef$current2,_socketRef$current3;(_socketRef$current=socketRef.current)===null||_socketRef$current===void 0?void 0:_socketRef$current.disconnect();(_socketRef$current2=socketRef.current)===null||_socketRef$current2===void 0?void 0:_socketRef$current2.off(ACTIONS.JOINED);(_socketRef$current3=socketRef.current)===null||_socketRef$current3===void 0?void 0:_socketRef$current3.off(ACTIONS.DISCONNECTED);};},[(_location$state3=location.state)===null||_location$state3===void 0?void 0:_location$state3.username,reactNavigator,roomId]);function copyRoomId(){return _copyRoomId.apply(this,arguments);}function _copyRoomId(){_copyRoomId=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return navigator.clipboard.writeText(roomId);case 3:toast.success(\"Room ID has been copied!\");_context2.next=9;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);toast.error(\"Could not copy the Room ID\");case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return _copyRoomId.apply(this,arguments);}function leaveRoom(){reactNavigator('/');}if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"mainWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"logo\",children:/*#__PURE__*/_jsx(\"img\",{src:\"/code-sync.png\",alt:\"logo\",className:\"logoImage\"})}),/*#__PURE__*/_jsx(\"h3\",{children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId);})})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn copyBtn\",onClick:copyRoomId,children:\"Copy ROOM ID\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn leaveBtn\",onClick:leaveRoom,children:\"Leave\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"editorWrap\",children:[/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;}}),/*#__PURE__*/_jsx(CodeRun,{codeRef:codeRef})]})]});};export default EditorPage;","map":{"version":3,"names":["React","useEffect","useRef","useState","Client","Editor","initSocket","ACTIONS","Navigate","useLocation","useNavigate","useParams","toast","CodeRun","EditorPage","codeRef","socketRef","location","roomId","reactNavigator","clients","setClients","init","handleErrors","e","error","current","on","err","emit","JOIN","username","state","JOINED","socketId","success","SYNC_CODE","code","DISCONNECTED","prev","filter","client","disconnect","off","copyRoomId","navigator","clipboard","writeText","leaveRoom","map"],"sources":["/Users/amankumar/Code-Together/src/pages/EditorPage.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport Client from '../components/Client';\nimport Editor from '../components/Editor';\nimport { initSocket } from '../socket';\nimport ACTIONS from '../Actions';\nimport { Navigate, useLocation, useNavigate, useParams } from 'react-router-dom';\nimport toast from 'react-hot-toast';\nimport CodeRun from '../components/CodeRun';\n\nconst EditorPage = () => {\n  const codeRef = useRef(null);\n  const socketRef = useRef(null);\n  const location = useLocation();\n  const { roomId } = useParams();\n  const reactNavigator = useNavigate();\n\n  const [clients, setClients] = useState([]);\n\n  useEffect(() => {\n    const init = async () => {\n      socketRef.current = await initSocket();\n\n      socketRef.current.on('connect_error', (err) => handleErrors(err));\n      socketRef.current.on('connect_failed', (err) => handleErrors(err));\n\n      function handleErrors(e) {\n        toast.error('Socket connection failed, try again later.');\n        reactNavigator('/');\n      }\n\n      socketRef.current.emit(ACTIONS.JOIN, {\n        roomId,\n        username: location.state?.username,\n      });\n\n      // Listening for joined events\n      socketRef.current.on(ACTIONS.JOINED, ({ clients, username, socketId }) => {\n        if (username !== location.state?.username) {\n          toast.success(`${username} joined the room.`);\n        }\n        setClients(clients);\n        socketRef.current.emit(ACTIONS.SYNC_CODE, {\n          code: codeRef.current,\n          socketId\n        });\n      });\n\n      //listening for disconnected\n      socketRef.current.on(ACTIONS.DISCONNECTED, ({ socketId, username }) => {\n        toast.success(`${username} left the room.`);\n        setClients((prev) => {\n          return prev.filter((client) => client.socketId !== socketId);\n        });\n      });\n\n    };\n\n    init();\n    \n    return () => {\n      socketRef.current?.disconnect();\n      socketRef.current?.off(ACTIONS.JOINED);\n      socketRef.current?.off(ACTIONS.DISCONNECTED);\n    };\n\n  }, [location.state?.username, reactNavigator, roomId]);\n\n  async function copyRoomId() {\n    try {\n      await navigator.clipboard.writeText(roomId);\n      toast.success(\"Room ID has been copied!\");\n    } catch (err) {\n      toast.error(\"Could not copy the Room ID\");\n    }\n  }\n\n  function leaveRoom() {\n    reactNavigator('/');\n  }\n\n  if (!location.state) {\n    return <Navigate to=\"/\"/>\n  }\n\n  return (\n    <div className=\"mainWrap\">\n      <div className=\"aside\">\n        <div className=\"asideInner\">\n          <div className=\"logo\">\n            <img src=\"/code-sync.png\" alt=\"logo\" className=\"logoImage\" />\n          </div>\n          <h3>Connected</h3>\n          <div className=\"clientsList\">\n            {clients.map((client) => (\n              <Client key={client.socketId} username={client.username} />\n            ))}\n          </div>\n        </div>\n\n        <button className=\"btn copyBtn\" onClick={copyRoomId}>\n          Copy ROOM ID\n        </button>\n        <button className=\"btn leaveBtn\" onClick={leaveRoom}>\n          Leave\n        </button>\n      </div>\n      <div className=\"editorWrap\">\n        <Editor\n          socketRef={socketRef}\n          roomId={roomId}\n          onCodeChange={(code) => {\n            codeRef.current = code;\n          }}\n        />\n        <CodeRun codeRef={codeRef} />\n      </div>\n    </div>\n  );\n}\n\nexport default EditorPage;"],"mappings":"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"},"metadata":{},"sourceType":"module"}